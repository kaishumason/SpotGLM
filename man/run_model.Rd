% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/glm_extension_adam.R
\name{run_model}
\alias{run_model}
\title{Fit a Spatial GLM with Initialization and Optimization}
\usage{
run_model(
  y,
  X,
  lambda,
  family = "spot gaussian",
  beta_0 = NULL,
  fix_coef = NULL,
  offset = rep(0, length(y)),
  initialization = T,
  CT = NULL,
  weights = rep(1, length(y)),
  ct_cov_weights = rep(1, ncol(lambda)),
  n_epochs = 100,
  batch_size = 500,
  learning_rate = 1,
  max_diff = 1 - 1e-06,
  improvement_threshold = 1e-06,
  max_conv = 10
)
}
\arguments{
\item{y}{Numeric response vector (e.g., gene expression for one gene across spots).}

\item{X}{Covariate matrix (spots × covariates).}

\item{lambda}{Deconvolution matrix (spots × cell types).}

\item{family}{GLM family: \code{"spot gaussian"}, \code{"spot poisson"}, \code{"spot negative binomial"}, or \code{"spot binomial"}.}

\item{beta_0}{Optional initial coefficient matrix (covariates × cell types).}

\item{fix_coef}{Logical matrix (covariates × cell types) indicating coefficients to fix during optimization.}

\item{offset}{Optional numeric vector (same length as \code{y}), used for Poisson or NB normalization.}

\item{initialization}{Boolean if initialization via single cell approximation should be performed. Default TRUE.}

\item{CT}{Optional vector of dominant cell type labels per spot.}

\item{weights}{Observation weights (same length as \code{y}).}

\item{ct_cov_weights}{Optional vector of cell-type–specific weights (length = number of cell types).}

\item{n_epochs}{Number of training epochs for gradient descent.}

\item{batch_size}{Size of mini-batches used during gradient descent.}

\item{learning_rate}{Initial learning rate for optimization.}

\item{max_diff}{Convergence threshold based on likelihood ratio.}

\item{improvement_threshold}{Minimum required improvement in likelihood ratio between epochs.}

\item{max_conv}{Number of consecutive low-improvement epochs before convergence is assumed.}
}
\value{
A list containing:
\describe{
\item{beta_est}{Estimated coefficient matrix (covariates × cell types).}
\item{stand_err_mat}{Standard error matrix for each coefficient.}
\item{time}{Elapsed fitting time (in seconds).}
\item{disp}{Estimated dispersion (for NB models).}
\item{converged}{Logical indicating if convergence was reached.}
\item{likelihood}{Final negative log-likelihood.}
\item{vcov}{Variance-covariance matrix.}
\item{niter}{Number of optimization epochs completed.}
\item{fixed_coef}{Final matrix indicating fixed coefficients.}
}
}
\description{
Fits a generalized linear model (GLM) with spatial deconvolution for a single response variable
(e.g., gene expression), supporting Poisson, Gaussian, Binomial, and Negative Binomial families.
This function handles coefficient initialization, model fitting via mini-batch gradient descent,
and automatic coefficient filtering for weak covariates or poorly represented cell types.
}

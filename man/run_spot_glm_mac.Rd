% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/glm_extension_adam.R
\name{run_spot_glm_mac}
\alias{run_spot_glm_mac}
\title{Parallelized Spot-GLM Model Fitting}
\usage{
run_spot_glm_mac(
  Y,
  X,
  lambda,
  family = "spot gaussian",
  beta_0 = NULL,
  fix_coef = NULL,
  initialization = "full",
  G = 0.1,
  num_cores = 1,
  offset = NULL,
  min_deconv = 0.1,
  min_freq = 50,
  CT = NULL,
  weights = NULL,
  ct_cov_weights = NULL,
  n_epochs = 100,
  batch_size = 500,
  learning_rate = 1,
  max_diff = 1 - 1e-06,
  improvement_threshold = 1e-06,
  max_conv = 10,
  intercept_col = NULL
)
}
\arguments{
\item{Y}{Response matrix (spots × responses).}

\item{X}{Covariate matrix (spots × covariates).}

\item{lambda}{Deconvolution matrix (spots × cell types).}

\item{family}{The GLM family to use. One of: "spot gaussian", "spot poisson",
"spot negative binomial", or "spot binomial".}

\item{beta_0}{Optional initial beta matrix (covariates × cell types).}

\item{fix_coef}{Optional logical matrix (covariates × cell types) indicating which coefficients to fix.}

\item{initialization}{Method used for initializing coefficients: "intercept" or "full".}

\item{G}{Maximum chunk size in gigabytes (used to control memory usage).}

\item{num_cores}{Number of CPU cores to use in parallel.}

\item{offset}{Optional offset vector (length equal to number of spots).}

\item{min_deconv}{Minimum required deconvolution value for a spot to be considered informative.}

\item{min_freq}{Minimum frequency for a covariate to be retained in a model.}

\item{CT}{Optional vector of dominant cell types per spot (used in initialization).}

\item{weights}{Optional matrix of observation-level weights (spots × genes).}

\item{ct_cov_weights}{Optional matrix of cell-type–specific weights per gene (cell types × genes).}

\item{learning_rate}{Initial learning rate for optimization.}

\item{max_diff}{Convergence threshold on likelihood improvement.}

\item{intercept_col}{Optional index of the intercept column in \code{X}, if it exists.}

\item{max_gd_steps}{Maximum number of gradient descent steps.}
}
\value{
A named list of model results (one per gene), where each element contains the estimated
coefficients, standard errors, dispersion, likelihood, and convergence diagnostics.
}
\description{
Applies Spot-GLM to multiple responses (e.g. genes) in parallel, using memory-efficient chunking and
multicore processing via the \code{parallel::mclapply} function. Mclapply only works for Macs. For windows users, please use \code{run_spot_glm_windows}
}
\details{
This function splits the gene expression matrix \code{Y} into chunks based on estimated memory usage,
then fits the Spot-GLM model in parallel across each gene using multiple CPU cores.

External packages used inside the parallel workers include: \code{Matrix}, \code{MASS}, and \code{LaplacesDemon}.
}
